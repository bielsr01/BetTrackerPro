Ã“timo â€” com esse package.json jÃ¡ dÃ¡ pra ver o problema real:
ğŸ‘‰ Seu build do servidor nÃ£o estÃ¡ incluindo a pasta /server/routes na saÃ­da dist/.

Por quÃª?

Porque seu script de build usa:

"build": "vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist"


Ou seja:

VocÃª sÃ³ bundleia o arquivo server/index.ts

O esbuild nÃ£o inclui arquivos que nÃ£o sÃ£o importados diretamente

E caso vocÃª faÃ§a imports "parciais" (ex: diretÃ³rio server/routes com vÃ¡rios arquivos), o esbuild sÃ³ inclui o que ele rastrear

Se vocÃª usa import "./routes" sem extensÃ£o ou sem referÃªncia direta para arquivos .ts, o esbuild simplesmente ignora

No deploy, a pasta /server/routes nÃ£o existe dentro de /var/task, logo o Node falha com:

ERR_MODULE_NOT_FOUND: Cannot find module '/var/task/server/routes'


Rodar local funciona porque localmente a pasta existe, mas no build nÃ£o existe mais.

âœ… Como resolver (qualquer uma das opÃ§Ãµes abaixo funciona)
âœ” OpÃ§Ã£o 1: adicionar extensÃ£o no import

Se no seu server/index.ts vocÃª tem:

import routes from "./routes";


Troque para:

import routes from "./routes/index.js"; // se for diretÃ³rio
// ou
import routes from "./routes.js"; // se for arquivo


ESM exige extensÃ£o.
Sem extensÃ£o, o esbuild ignora e nÃ£o inclui no bundle.

âœ” OpÃ§Ã£o 2: dizer ao esbuild para copiar os arquivos â€œnÃ£o bundleadosâ€

Adicione --asset-names e --loader para pastas e .ts:

"build": "vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist --loader:.ts=ts --loader:.json=json --outbase=server --metafile"


Ou uma forma mais simples:

ğŸ‘‰ Copiar manualmente a pasta server para dist:

No package.json:

"build": "vite build && esbuild server/index.ts --bundle --platform=node --format=esm --outdir=dist && cp -r server dist/server"


No Windows:

xcopy server dist/server /E /I


Isso garante que dist/server/routes/... exista no deploy.

âœ” OpÃ§Ã£o 3: transformar tudo em um Ãºnico bundle

Se vocÃª quiser um arquivo Ãºnico (como Lambda geralmente quer):

"build": "vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist --minify"


Mas esse mÃ©todo sÃ³ funciona se TODOS os imports sÃ£o arquivos explÃ­citos como:

import "./routes/user.ts";
import "./routes/admin.ts";

âœ” OpÃ§Ã£o 4: usar tsup (mais simples que esbuild)

Substituir totalmente o build do servidor:

npm i -D tsup


E no package.json:

"build": "vite build && tsup server/index.ts --format esm --dts --splitting --out-dir dist"

ğŸ“Œ ConclusÃ£o

Seu problema nÃ£o Ã© path errado, e sim:

âŒ A pasta server/routes nÃ£o vai para o deploy
âŒ O esbuild nÃ£o estÃ¡ incluindo os arquivos
âŒ O Node nÃ£o encontra o mÃ³dulo no ambiente final